apply plugin: 'base'

apply plugin: 'com.moowork.node'

task buildLib(type: NpmTask) {
    dependsOn('npmInstall')
    inputs.dir project.file('src')
    inputs.file project.file('package.json')
    inputs.file project.file('tsconfig.json')
    inputs.file project.file('rollup.config.js')
    outputs.dir project.file('lib')
    args = ["run", "build"]
}

assemble.dependsOn 'buildLib'

//task buildDoc(type: NpmTask) {
//    dependsOn('npmInstall')
//    inputs.file project.file('README.md')
//    inputs.dir project.file('src')
//    inputs.file project.file('package.json')
//    outputs.dir project.file("${rootProject.buildDir}/aashdoc")
//    args = ["run", "build:doc"]
//}

ext.jsDocDestDir = "${rootProject.buildDir}/aashdoc"

task jsdoc(type: NodeTask) {
    dependsOn(':npmInstall')
    new File(jsDocDestDir).mkdirs()
    script = file("${rootProject.projectDir}/node_modules/jsdoc/jsdoc.js")
    args = [
        "-c",
        "${rootProject.projectDir}/jsdoc.json",
        "--destination",
        jsDocDestDir,
        "resources/org/jgrapes/webconsole/base/jgconsole.js"
    ]
}


task buildDoc(type: Task) {
    
}

build.dependsOn 'buildDoc'

eclipse {
    autoBuildTasks buildLib
}

apply plugin: 'eclipse'

eclipse {
    project {
        buildCommand 'org.eclipse.wst.validation.validationbuilder'
        natures 'org.eclipse.wst.jsdt.core.jsNature'
    }
}

tasks.eclipse.dependsOn(cleanEclipse)
